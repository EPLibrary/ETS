"use strict";function LatLon(t,a){if(!(this instanceof LatLon))return new LatLon(t,a);this.lat=Number(t),this.lon=Number(a)}if("undefined"!=typeof module&&module.exports)var Dms=require("./dms");LatLon.prototype.distanceTo=function(t,a){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");var n=a=void 0===a?6371e3:Number(a),o=this.lat.toRadians(),s=this.lon.toRadians(),i=t.lat.toRadians(),h=i-o,e=t.lon.toRadians()-s,r=Math.sin(h/2)*Math.sin(h/2)+Math.cos(o)*Math.cos(i)*Math.sin(e/2)*Math.sin(e/2);return n*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))},LatLon.prototype.bearingTo=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");var a=this.lat.toRadians(),n=t.lat.toRadians(),o=(t.lon-this.lon).toRadians(),s=Math.sin(o)*Math.cos(n),i=Math.cos(a)*Math.sin(n)-Math.sin(a)*Math.cos(n)*Math.cos(o);return(Math.atan2(s,i).toDegrees()+360)%360},LatLon.prototype.finalBearingTo=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");return(t.bearingTo(this)+180)%360},LatLon.prototype.midpointTo=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");var a=this.lat.toRadians(),n=this.lon.toRadians(),o=t.lat.toRadians(),s=(t.lon-this.lon).toRadians(),i=Math.cos(o)*Math.cos(s),h=Math.cos(o)*Math.sin(s),e=Math.sqrt((Math.cos(a)+i)*(Math.cos(a)+i)+h*h),r=Math.sin(a)+Math.sin(o),M=Math.atan2(r,e),c=n+Math.atan2(h,Math.cos(a)+i);return new LatLon(M.toDegrees(),(c.toDegrees()+540)%360-180)},LatLon.prototype.intermediatePointTo=function(t,a){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");var n=this.lat.toRadians(),o=this.lon.toRadians(),s=t.lat.toRadians(),i=t.lon.toRadians(),h=Math.sin(n),e=Math.cos(n),r=Math.sin(o),M=Math.cos(o),c=Math.sin(s),L=Math.cos(s),u=Math.sin(i),l=Math.cos(i),d=s-n,p=i-o,f=Math.sin(d/2)*Math.sin(d/2)+Math.cos(n)*Math.cos(s)*Math.sin(p/2)*Math.sin(p/2),b=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),R=Math.sin((1-a)*b)/Math.sin(b),g=Math.sin(a*b)/Math.sin(b),m=R*e*M+g*L*l,v=R*e*r+g*L*u,P=R*h+g*c,y=Math.atan2(P,Math.sqrt(m*m+v*v)),w=Math.atan2(v,m);return new LatLon(y.toDegrees(),(w.toDegrees()+540)%360-180)},LatLon.prototype.destinationPoint=function(t,a,n){n=void 0===n?6371e3:Number(n);var o=Number(t)/n,s=Number(a).toRadians(),i=this.lat.toRadians(),h=this.lon.toRadians(),e=Math.sin(i),r=Math.cos(i),M=Math.sin(o),c=Math.cos(o),L=Math.sin(s),u=e*c+r*M*Math.cos(s),l=Math.asin(u),d=L*M*r,p=c-e*u,f=h+Math.atan2(d,p);return new LatLon(l.toDegrees(),(f.toDegrees()+540)%360-180)},LatLon.intersection=function(t,a,n,o){if(!(t instanceof LatLon))throw new TypeError("p1 is not LatLon object");if(!(n instanceof LatLon))throw new TypeError("p2 is not LatLon object");var s=t.lat.toRadians(),i=t.lon.toRadians(),h=n.lat.toRadians(),e=n.lon.toRadians(),r=Number(a).toRadians(),M=Number(o).toRadians(),c=h-s,L=e-i,u=2*Math.asin(Math.sqrt(Math.sin(c/2)*Math.sin(c/2)+Math.cos(s)*Math.cos(h)*Math.sin(L/2)*Math.sin(L/2)));if(0==u)return null;var l=Math.acos((Math.sin(h)-Math.sin(s)*Math.cos(u))/(Math.sin(u)*Math.cos(s)));isNaN(l)&&(l=0);var d=Math.acos((Math.sin(s)-Math.sin(h)*Math.cos(u))/(Math.sin(u)*Math.cos(h))),p=Math.sin(e-i)>0?l:2*Math.PI-l,f=Math.sin(e-i)>0?2*Math.PI-d:d,b=(r-p+Math.PI)%(2*Math.PI)-Math.PI,R=(f-M+Math.PI)%(2*Math.PI)-Math.PI;if(0==Math.sin(b)&&0==Math.sin(R))return null;if(Math.sin(b)*Math.sin(R)<0)return null;var g=Math.acos(-Math.cos(b)*Math.cos(R)+Math.sin(b)*Math.sin(R)*Math.cos(u)),m=Math.atan2(Math.sin(u)*Math.sin(b)*Math.sin(R),Math.cos(R)+Math.cos(b)*Math.cos(g)),v=Math.asin(Math.sin(s)*Math.cos(m)+Math.cos(s)*Math.sin(m)*Math.cos(r)),P=i+Math.atan2(Math.sin(r)*Math.sin(m)*Math.cos(s),Math.cos(m)-Math.sin(s)*Math.sin(v));return new LatLon(v.toDegrees(),(P.toDegrees()+540)%360-180)},LatLon.prototype.crossTrackDistanceTo=function(t,a,n){if(!(t instanceof LatLon))throw new TypeError("pathStart is not LatLon object");if(!(a instanceof LatLon))throw new TypeError("pathEnd is not LatLon object");n=void 0===n?6371e3:Number(n);var o=t.distanceTo(this,n)/n,s=t.bearingTo(this).toRadians(),i=t.bearingTo(a).toRadians();return Math.asin(Math.sin(o)*Math.sin(s-i))*n},LatLon.prototype.maxLatitude=function(t){var a=Number(t).toRadians(),n=this.lat.toRadians();return Math.acos(Math.abs(Math.sin(a)*Math.cos(n))).toDegrees()},LatLon.crossingParallels=function(t,a,n){var o=Number(n).toRadians(),s=t.lat.toRadians(),i=t.lon.toRadians(),h=a.lat.toRadians(),e=a.lon.toRadians()-i,r=Math.sin(s)*Math.cos(h)*Math.cos(o)*Math.sin(e),M=Math.sin(s)*Math.cos(h)*Math.cos(o)*Math.cos(e)-Math.cos(s)*Math.sin(h)*Math.cos(o),c=Math.cos(s)*Math.cos(h)*Math.sin(o)*Math.sin(e);if(c*c>r*r+M*M)return null;var L=Math.atan2(-M,r),u=Math.acos(c/Math.sqrt(r*r+M*M)),l=i+L+u;return{lon1:((i+L-u).toDegrees()+540)%360-180,lon2:(l.toDegrees()+540)%360-180}},LatLon.prototype.rhumbDistanceTo=function(t,a){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");var n=a=void 0===a?6371e3:Number(a),o=this.lat.toRadians(),s=t.lat.toRadians(),i=s-o,h=Math.abs(t.lon-this.lon).toRadians();Math.abs(h)>Math.PI&&(h=h>0?-(2*Math.PI-h):2*Math.PI+h);var e=Math.log(Math.tan(s/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),r=Math.abs(e)>1e-11?i/e:Math.cos(o);return Math.sqrt(i*i+r*r*h*h)*n},LatLon.prototype.rhumbBearingTo=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");var a=this.lat.toRadians(),n=t.lat.toRadians(),o=(t.lon-this.lon).toRadians();Math.abs(o)>Math.PI&&(o=o>0?-(2*Math.PI-o):2*Math.PI+o);var s=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(a/2+Math.PI/4));return(Math.atan2(o,s).toDegrees()+360)%360},LatLon.prototype.rhumbDestinationPoint=function(t,a,n){n=void 0===n?6371e3:Number(n);var o=Number(t)/n,s=this.lat.toRadians(),i=this.lon.toRadians(),h=Number(a).toRadians(),e=o*Math.cos(h),r=s+e;Math.abs(r)>Math.PI/2&&(r=r>0?Math.PI-r:-Math.PI-r);var M=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),c=Math.abs(M)>1e-11?e/M:Math.cos(s),L=i+o*Math.sin(h)/c;return new LatLon(r.toDegrees(),(L.toDegrees()+540)%360-180)},LatLon.prototype.rhumbMidpointTo=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");var a=this.lat.toRadians(),n=this.lon.toRadians(),o=t.lat.toRadians(),s=t.lon.toRadians();Math.abs(s-n)>Math.PI&&(n+=2*Math.PI);var i=(a+o)/2,h=Math.tan(Math.PI/4+a/2),e=Math.tan(Math.PI/4+o/2),r=Math.tan(Math.PI/4+i/2),M=((s-n)*Math.log(r)+n*Math.log(e)-s*Math.log(h))/Math.log(e/h);return isFinite(M)||(M=(n+s)/2),LatLon(i.toDegrees(),(M.toDegrees()+540)%360-180)},LatLon.areaOf=function(t,a){var n=void 0===a?6371e3:Number(a),o=t[0].equals(t[t.length-1]);o||t.push(t[0]);for(var s=t.length-1,i=0,h=0;h<s;h++){var e=t[h].lat.toRadians(),r=t[h+1].lat.toRadians(),M=(t[h+1].lon-t[h].lon).toRadians();i+=2*Math.atan2(Math.tan(M/2)*(Math.tan(e/2)+Math.tan(r/2)),1+Math.tan(e/2)*Math.tan(r/2))}(function(t){for(var a=0,n=t[0].bearingTo(t[1]),o=0;o<t.length-1;o++){var s=t[o].bearingTo(t[o+1]),i=t[o].finalBearingTo(t[o+1]);a+=(s-n+540)%360-180,a+=(i-s+540)%360-180,n=i}return a+=((s=t[0].bearingTo(t[1]))-n+540)%360-180,Math.abs(a)<90})(t)&&(i=Math.abs(i)-2*Math.PI);var c=Math.abs(i*n*n);return o||t.pop(),c},LatLon.prototype.equals=function(t){if(!(t instanceof LatLon))throw new TypeError("point is not LatLon object");return this.lat==t.lat&&this.lon==t.lon},LatLon.prototype.toString=function(t,a){return Dms.toLat(this.lat,t,a)+", "+Dms.toLon(this.lon,t,a)},void 0===Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),void 0===Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI}),"undefined"!=typeof module&&module.exports&&(module.exports=LatLon);